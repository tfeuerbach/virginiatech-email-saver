<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing Submission</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Processing Your Submission...</h1>
        <div id="output-container">
            <p>Preparing to submit...</p>
        </div>
    </div>
    <script>
        const email = localStorage.getItem("email"); // Retrieve email from local storage

        // Poll the server for progress updates
        function pollProgress() {
            fetch("/get_progress")
                .then((response) => response.json())
                .then((data) => {
                    const outputContainer = document.getElementById("output-container");
                    const stepMessages = {
                        0: "Preparing to submit...",
                        1: "Storing your credentials securely...",
                        2: "Attempting to log in...",
                        3: "Sending a push notification to your device...",
                        4: "Login Successful! Redirecting to your dashboard...",
                    };

                    // Update the output container with the current step message
                    outputContainer.innerHTML = `<p>${stepMessages[data.step] || "Unknown progress step."}</p>`;

                    // Redirect to dashboard if the process is complete
                    if (data.step === 4) {
                        setTimeout(() => {
                            window.location.href = `/dashboard?email=${encodeURIComponent(email)}`;
                        }, 2000); // Wait 2 seconds before redirecting
                    }
                })
                .catch((error) => {
                    console.error("Error polling progress:", error);
                });
        }

        // Start polling every second
        setInterval(pollProgress, 1000);
    </script>
</body>
</html>
